"use strict";(self["webpackChunkNGGG"]=self["webpackChunkNGGG"]||[]).push([[50],{4641:function(e,n,s){s.r(n),s.d(n,{default:function(){return C}});var t=s(3614),i=(s(6809),s(1015)),a=(s(8474),s(5791)),o=s(9379),l=s(3396);const d=e=>((0,l.dD)("data-v-1d939c5f"),e=e(),(0,l.Cn)(),e),u={class:"container"},r={class:"video-group"},c={class:"flex-column"},v={class:"control-buttons"},m=d((()=>(0,l._)("span",{class:"button-text"},"나가기",-1)));function g(e,n,s,d,g,p){const x=o.Z,b=a.Z,_=(0,l.up)("Close"),h=i.gn,y=t.mi;return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("div",u,[(0,l._)("div",r,[(0,l.Wm)(x,{class:"seller-video",streamManager:e.publisher},null,8,["streamManager"])]),(0,l._)("div",c,[(0,l.Wm)(b,{onSendMessage:e.sendMessage,"message-list":e.messageList},null,8,["onSendMessage","message-list"])])]),(0,l._)("div",v,[(0,l.Wm)(y,{round:"",type:"danger",onClick:e.onClickExit},{default:(0,l.w5)((()=>[(0,l.Wm)(h,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_)])),_:1}),m])),_:1},8,["onClick"])])],64)}s(7658);var p=s(4870),x=s(2483),b=s(65),_=s(9801),h=s(7654),y=(0,l.aZ)({name:"JoinView",components:{OvVideo:o.Z,ChatBox:a.Z},setup(){const e=(0,b.oR)(),n=(0,x.yj)(),s=(0,x.tv)();let t;const i=(0,p.qj)({my_index:-1,seller_index:-1,buyer_index:-1,meeting_index:-1}),a=async e=>{try{const n=await(0,h.rQ)(e),s=n.data;i.seller_index=s.sellerIndex,i.buyer_index=s.buyderIndex,t=s.token,i.seller_index===i.my_index&&(c=o)}catch(n){alert("오류 발생")}},o=document.querySelector("video#sellerVideo"),d=document.querySelector("video#buyderVideo");let u,r,c=d;const v=(0,p.iH)();let m=[];const g=async()=>{u=new _.OpenVidu,r=u.initSession(),r.on("streamCreated",(({stream:e})=>{let n=r.subscribe(e,void 0);m.push(n)})),r.on("streamDestroyed",(({stream:e})=>{const n=m.indexOf(e.streamManager,0);n>=0&&m.splice(n,1)})),r.on("exception",(({exception:e})=>{console.warn(e)})),r.on("signal:chat",(e=>{const n=JSON.parse(e.data).message;y.push({isMine:!1,text:n,sendedTime:new Date})})),await r.connect(t),v.value=u.initPublisher(c,{audioSource:void 0,videoSource:void 0,publishAudio:!0,publishVideo:!0,insertMode:"APPEND",mirror:!1}),r.publish(v)},y=(0,p.qj)([]);(0,l.YP)((()=>y.length),(()=>y.sort(((e,n)=>e.sendedTime.valueOf()-n.sendedTime.valueOf()))));const f=e=>{y.push(e);const n={data:JSON.stringify({message:e}),type:"chat",to:void 0};r.signal(n)},w=()=>{r&&r.disconnect(),r=void 0,v.value=void 0,m=[],u.value=void 0,window.removeEventListener("beforeunload",w)};(0,l.bv)((async()=>{i.my_index=(0,l.Fl)((()=>e.getters["userStore/userIndex"])).value,i.meeting_index=(0,l.Fl)((()=>parseInt(n.params.id[0]))).value,await a(i.meeting_index),g()}));const C=(0,p.iH)(!1),M=(0,p.iH)(!1),k=(0,p.iH)(!0),S=()=>{C.value=!C.value,v.value.publishAudio(C.value)},V=()=>{M.value=!M.value,v.value.publishVideo(C.value)},O=()=>{k.value=!k.value},G=()=>{confirm("정말 나가시겠습니까?")&&(w(),s.back())};return{onClickExit:G,sendMessage:f,messageList:y,muteMic:S,muteVideo:V,toggleChatMode:O}}}),f=s(89);const w=(0,f.Z)(y,[["render",g],["__scopeId","data-v-1d939c5f"]]);var C=w}}]);
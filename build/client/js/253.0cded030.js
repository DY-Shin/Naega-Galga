"use strict";(self["webpackChunkNGGG"]=self["webpackChunkNGGG"]||[]).push([[253],{8823:function(e,a,n){n.r(a),n.d(a,{default:function(){return K}});var t=n(3614),o=(n(6809),n(1015)),s=(n(8474),n(5791)),i=n(3396);const l={id:"map"};function u(e,a,n,t,o,s){return(0,i.wg)(),(0,i.iD)("div",l)}var r=n(4870),d={props:{centerLatLng:{type:Object,x:Number,y:Number},needPositionTracking:{type:Boolean}},setup(e,{emit:a}){const{centerLatLng:n,needPositionTracking:t}=(0,r.BK)(e);(0,i.bv)((()=>{if(window.kakao&&window.kakao.maps)return void o();const e=document.createElement("script");return e.async=!0,e.src="//dapi.kakao.com/v2/maps/sdk.js?autoload=false&appkey=b898e14419dd1bcc7c1a9ff581034a0a&libraries=services",document.head.appendChild(e),e.addEventListener("load",o),()=>e.removeEventListener("load",o)}));const o=()=>{window.kakao.maps.load((()=>{const e=document.getElementById("map"),a={center:new window.kakao.maps.LatLng(36.1020372425131,128.420294611527)};window.map=new window.kakao.maps.Map(e,a)}))},s={enableHighAccuracy:!0,timeout:1e4,maximumAge:0};function l(e){const a=new window.kakao.maps.LatLng(e.y,e.x);window.map.setCenter(a),window.map.setLevel(5);const n=new window.kakao.maps.Marker({position:a});n.setMap(window.map)}function u(e){const n=e.coords;l({x:n.longitude,y:n.latitude}),a("changeSellerPosition",{x:n.longitude,y:n.latitude})}function d(e){console.log(e)}t?navigator.geolocation.watchPosition(u,d,s):(0,i.YP)((()=>n.value),(()=>{l(n.value)}))}},c=n(89);const m=(0,c.Z)(d,[["render",u],["__scopeId","data-v-b6ffe0d0"]]);var g=m,v=n(9379);const p={key:0};function w(e,a,n,t,o,s){const l=v.Z;return n.streamManager?((0,i.wg)(),(0,i.iD)("div",p,[(0,i.Wm)(l,{"stream-manager":n.streamManager},null,8,["stream-manager"])])):(0,i.kq)("",!0)}var y={name:"UserVideo",components:{OvVideo:v.Z},props:{streamManager:Object},computed:{clientData(){const{clientData:e}=this.getConnectionData();return e}},methods:{getConnectionData(){const{connection:e}=this.streamManager.stream;return JSON.parse(e.data)}}};const k=(0,c.Z)(y,[["render",w]]);var b=k;const M=e=>((0,i.dD)("data-v-1f3cbaea"),e=e(),(0,i.Cn)(),e),h={class:"container"},f={key:0,class:"video-group"},x={class:"float-right flex-column"},C={key:0,class:"map border shadow"},L={key:2},S={key:0,class:"map border shadow"},V={class:"control-buttons"},D={key:2,class:"button-text"},P={key:3,class:"button-text"},_={key:2,class:"button-text"},W={key:3,class:"button-text"},O={key:0},j=M((()=>(0,i._)("span",{class:"button-text"},"채팅",-1))),N={key:1},H=M((()=>(0,i._)("span",{class:"button-text"},"지도",-1))),E=M((()=>(0,i._)("span",{class:"button-text"},"나가기",-1)));function Z(e,a,n,l,u,r){const d=b,c=g,m=s.Z,v=(0,i.up)("Microphone"),p=o.gn,w=(0,i.up)("Mute"),y=t.mi,k=(0,i.up)("VideoCamera"),M=(0,i.up)("VideoPause"),Z=(0,i.up)("ChatRound"),q=(0,i.up)("LocationFilled"),F=(0,i.up)("Close");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",h,[l.session?((0,i.wg)(),(0,i.iD)("div",f,[(0,i.Wm)(d,{id:"seller-video","stream-manager":l.isSeller?l.subscriber:l.publisher,onClick:a[0]||(a[0]=e=>l.updateMainVideoStreamManager(l.isSeller?l.subscriber:l.publisher))},null,8,["stream-manager"]),(0,i.Wm)(d,{id:"buyer-video","stream-manager":l.isSeller?l.publisher:l.subscriber,onClick:a[1]||(a[1]=e=>l.updateMainVideoStreamManager(l.isSeller?l.publisher:l.subscriber))},null,8,["stream-manager"])])):(0,i.kq)("",!0),(0,i._)("div",x,[l.isMobileScreen?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",C,[(0,i.Wm)(c,{centerLatLng:l.centerLatLng,trackMyPosition:l.isSeller,onChangeSellerPosition:l.changeSellerPosition},null,8,["centerLatLng","trackMyPosition","onChangeSellerPosition"])])),l.isMobileScreen?((0,i.wg)(),(0,i.iD)("div",L,[l.isChatMode?((0,i.wg)(),(0,i.j4)(m,{key:1,onSendMessage:l.sendMessage,"message-list":l.messageList},null,8,["onSendMessage","message-list"])):((0,i.wg)(),(0,i.iD)("div",S,[(0,i.Wm)(c,{centerLatLng:l.centerLatLng,trackMyPosition:l.isSeller},null,8,["centerLatLng","trackMyPosition"])]))])):((0,i.wg)(),(0,i.j4)(m,{key:1,onSendMessage:l.sendMessage,"message-list":l.messageList},null,8,["onSendMessage","message-list"]))])]),(0,i._)("div",V,[(0,i.Wm)(y,{modelValue:l.myMicMute,"onUpdate:modelValue":a[2]||(a[2]=e=>l.myMicMute=e),round:"",onClick:l.muteMic},{default:(0,i.w5)((()=>[l.myMicMute?((0,i.wg)(),(0,i.j4)(p,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(v)])),_:1})):((0,i.wg)(),(0,i.j4)(p,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(w)])),_:1})),l.myMicMute?((0,i.wg)(),(0,i.iD)("span",D,"ON")):((0,i.wg)(),(0,i.iD)("span",P,"OFF"))])),_:1},8,["modelValue","onClick"]),(0,i.Wm)(y,{modelValue:l.myVideoMute,"onUpdate:modelValue":a[3]||(a[3]=e=>l.myVideoMute=e),round:"",onClick:l.muteVideo},{default:(0,i.w5)((()=>[l.myVideoMute?((0,i.wg)(),(0,i.j4)(p,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(k)])),_:1})):((0,i.wg)(),(0,i.j4)(p,{key:1},{default:(0,i.w5)((()=>[(0,i.Wm)(M)])),_:1})),l.myVideoMute?((0,i.wg)(),(0,i.iD)("span",_,"ON")):((0,i.wg)(),(0,i.iD)("span",W,"OFF"))])),_:1},8,["modelValue","onClick"]),l.isMobileScreen?((0,i.wg)(),(0,i.j4)(y,{key:0,round:"",onClick:l.toggleChatMode},{default:(0,i.w5)((()=>[l.isChatMode?((0,i.wg)(),(0,i.iD)("span",O,[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(Z)])),_:1}),j])):((0,i.wg)(),(0,i.iD)("span",N,[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(q)])),_:1}),H]))])),_:1},8,["onClick"])):(0,i.kq)("",!0),(0,i.Wm)(y,{round:"",type:"danger",onClick:l.onClickExit},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(F)])),_:1}),E])),_:1},8,["onClick"])])],64)}n(7658);var q=n(2483),F=n(65),G=n(5119);const I=(0,G.ach)("(max-width: 500px)");var T=n(7654),A=n(9801),B=n(2748),J=n(5679),U={components:{ChatBox:s.Z,Microphone:B.PjE,Mute:B.g7M,VideoCamera:B.z1e,VideoPause:B.lBU,ChatRound:B.ulo,LocationFilled:B.y$G,Close:B.x8P,KakaoMap:g,UserVideo:b},setup(){const e=(0,F.oR)(),a=(0,q.tv)();let n;const t=(0,r.qj)({my:-1,seller:-1,buyer:-1,meeting:-1});let o=(0,r.iH)(!1);t.my=(0,i.Fl)((()=>e.getters["userStore/userIndex"])).value;const s=window.location.href,l=s.split("/");t.meeting=parseInt(l[l.length-1]);const u=async e=>{const a=await(0,T.z5)(e),s=a.data;t.seller=s.sellerIndex,t.buyer=s.buyderIndex,n=s.token,t.seller===t.my&&(o.value=!0),a.status===J.Z.Ok&&p()};u(t.meeting);const d=(0,r.iH)(),c=(0,r.iH)(),m=(0,r.iH)(),g=(0,r.iH)(),v=(0,r.iH)();function p(){d.value=new A.OpenVidu,c.value=d.value.initSession(),c.value.on("signal:map",(e=>{const a=JSON.parse(e.data).message,n=a.data;w.x=n.x,w.y=n.y})),c.value.on("streamCreated",(({stream:e})=>{const a=c.value.subscribe(e);v.value=a,y(w)})),c.value.on("streamDestroyed",(()=>{v.value=null})),c.value.on("exception",(({exception:e})=>{console.warn(e)})),c.value.on("signal:chat",(e=>{const a=JSON.parse(e.data).message;a.index!==t.my&&k.push({index:a.index,text:a.text,sendedTime:a.sendedTime})})),c.value.connect(n,{clientData:t.my}).then((()=>{console.log(n);let e=d.value.initPublisher(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:!0,publishVideo:!0,resolution:"640x480",frameRate:30,insertMode:"APPEND",mirror:!1});m.value=e,g.value=e,c.value.publish(g.value),window.addEventListener("beforeunload",S)}))}const w=(0,r.qj)({x:33.450701,y:126.570667});function y(e){if(w.x=e.x,w.y=e.y,o.value){const a={data:JSON.stringify({coords:e}),type:"map",to:void 0};c.value.signal(a)}}const k=(0,r.qj)([]);(0,i.YP)((()=>k.length),(()=>k.sort(((e,a)=>e.sendedTime.valueOf()-a.sendedTime.valueOf()))));const b=e=>{k.push(e);const a={data:JSON.stringify({message:e}),type:"chat",to:void 0};c.value.signal(a)},M=(0,r.iH)(!1),h=(0,r.iH)(!1),f=(0,r.iH)(!0),x=()=>{M.value=!M.value,g.value.publishAudio(M.value)},C=()=>{h.value=!h.value,g.value.publishVideo(h.value)},L=()=>{f.value=!f.value},S=()=>{void 0!==c.value&&c.value.disconnect(),c.value=void 0,g.value=void 0,v.value=null,d.value=void 0,m.value=void 0,window.removeEventListener("beforeunload",S)},V=async()=>{if(confirm("정말 나가시겠습니까?"))try{const e=await(0,T.aK)(t.meeting,t.my,n);e.status===J.Z.Ok&&S()}finally{a.replace("/user/reservation")}};function D(e){m.value!==e&&(m.value=e)}return{updateMainVideoStreamManager:D,isMobileScreen:I,isSeller:o,publisher:g,subscriber:v,session:c,messageList:k,sendMessage:b,centerLatLng:w,changeSellerPosition:y,myMicMute:M,myVideoMute:h,isChatMode:f,muteMic:x,muteVideo:C,toggleChatMode:L,onClickExit:V}}};const R=(0,c.Z)(U,[["render",Z],["__scopeId","data-v-1f3cbaea"]]);var K=R}}]);